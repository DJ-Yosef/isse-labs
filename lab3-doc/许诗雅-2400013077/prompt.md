# TodoList 系统开发标准

---
## 项目目标

请你帮我用 Flask（后端） + HTML/CSS/JavaScript（前端） 设计一个 **TodoList 任务管理系统**，要求实现以下功能：

1. 用户可输入新的待办事项；
2. 待办事项展示在列表中；
3. 可删除任务；
4. 可标记任务为完成；
5. 任务可按照优先级分类（高/中/低）；
6. 任务可按类别（学习/工作/生活）进行分类与筛选；
7. 支持任务截止时间设置与展示；
8. 支持按截止时间排序（正序/倒序）；
9. 支持任务搜索（按标题关键词）；
10. 支持按完成情况筛选（已完成/已截止/未完成）；
11. 数据持久化到本地 `tasks.json` 文件。

---
## 开发规范说明

> 目的：生成一个清晰分层、易于扩展的系统，便于教学演示与调试。
所有代码请分模块编写，后端和前端逻辑清晰独立。

---
## 一、技术栈与语言定义

- 后端框架：Python Flask
- 前端：HTML + CSS + JavaScript（原生，不使用框架）
- 数据格式：JSON
- 存储方式：本地 `tasks.json` 文件（持久化存储）
- 运行方式：Flask 提供 RESTful API，前端用 `fetch()` 调用接口

---
## 二、开发顺序（强制分步）
请按以下顺序生成与测试代码，每步都需自检说明。

### 第一步：后端接口设计

1. 设计 Flask 后端，包含以下路由：
   - `GET /tasks`：获取任务（支持筛选与排序）；
     - 查询参数：
       - `category`：按类别筛选（如“学习”）；
       - `priority`：按优先级筛选（如“高”）；
       - `status`：按完成情况筛选（`completed`/`overdue`/`pending`）；
       - `search`：按标题关键词搜索（模糊匹配）；
       - `sort`：排序方式（`deadline_asc` 按截止时间正序，`deadline_desc` 按截止时间倒序）；
   - `POST /tasks`：新增任务；
   - `PUT /tasks/<id>`：修改任务状态（完成/未完成）；
   - `DELETE /tasks/<id>`：删除任务；

2. 每个任务对象字段如下：
```json
{
  "id": 1,
  "title": "写实验报告",
  "category": "学习",
  "priority": "高",
  "completed": false,
  "deadline": "2023-12-31T23:59:59"  // ISO格式 datetime
}
```
3. 数据存储：使用 `tasks.json` 文件持久化存储，实现以下逻辑：
   - 启动时从文件加载数据到内存；
   - 每次新增/修改/删除任务后，同步写入文件；
   - 处理文件读写异常（如文件不存在时自动创建）。

4. 后端返回统一格式：
```json
{
  "status": "success",
  "data": [...],
  "message": "操作成功"
}
```
   错误时返回：
```json
{
  "status": "error",
  "data": null,
  "message": "错误描述"
}
```

5. 编写 `app.py`，测试接口在 Postman 或浏览器中能正常返回。

---
### 第二步：前端页面结构设计

1. 设计一个主页面 `index.html`，包含以下部分：
   - 输入区：
     - 任务标题输入框；
     - 分类下拉菜单（学习/工作/生活）；
     - 优先级下拉菜单（高/中/低）；
     - 截止时间选择器（datetime-local 类型）；
     - “添加任务”按钮；
   - 搜索区：
     - 搜索输入框（ placeholder：“搜索任务...”）；
     - “搜索”按钮；
   - 筛选区：
     - 分类筛选下拉菜单；
     - 优先级筛选下拉菜单；
     - 完成情况筛选下拉菜单（全部/已完成/已截止/未完成）；
     - 排序选项（默认/按截止时间正序/按截止时间倒序）；
     - “显示全部”按钮；
   - 任务展示区（列表形式）：
     - 每项包含：标题、类别、优先级、截止时间、状态（完成/未完成/已截止）、操作按钮（完成/删除）。

2. 页面布局：
   - 顶部：输入区 + 搜索区；
   - 中间：筛选区；
   - 底部：任务列表。

3. 样式说明：
   - 未完成任务：黑色文本；
   - 已完成任务：灰色文本 + 删除线；
   - 已截止任务：红色文本 + 闪烁边框（或其他醒目样式）；
   - 高优先级任务：红色标识；
   - 截止时间小于24小时且未完成：橙色标识。

---
### 第三步：前端逻辑与交互（JavaScript）

1. 使用 `fetch()` 调用后端 API，实现以下功能：
   - 添加任务：POST（包含截止时间字段）；
   - 加载任务列表：GET（支持携带筛选、搜索、排序参数）；
   - 删除任务：DELETE；
   - 切换任务状态：PUT；
   - 搜索任务：输入关键词后调用带 `search` 参数的 GET；
   - 筛选任务：选择条件后调用带对应参数的 GET；
   - 排序任务：选择排序方式后调用带 `sort` 参数的 GET。

2. 每次操作后自动刷新列表。

3. 编写 `script.js`，逻辑清晰、模块化：
   - `loadTasks(filters)`：加载任务（接收筛选参数）；
   - `addTask()`：新增任务；
   - `deleteTask(id)`：删除任务；
   - `toggleTask(id)`：切换任务完成状态；
   - `searchTasks(keyword)`：搜索任务；
   - `filterTasksByStatus(status)`：按完成情况筛选；
   - `sortTasks(order)`：按时间排序。

---
### 第四步：模块化结构要求
项目结构如下（AI生成代码需遵守）：
```
project/           # 项目代码目录
    ├── app.py              # Flask 后端
    ├── index.html          # 前端主页面
    ├── script.js           # 前端逻辑
    ├── style.css           # 样式文件
    └── tasks.json          # 任务数据文件（自动生成）
```
---
## 三、补充开发规范

| 类别       | 规范内容                                   |
| ---------- | ------------------------------------------ |
| 路由命名   | 使用 RESTful 风格                          |
| 变量命名   | 驼峰命名法（addTask, getTasks）            |
| 数据交互   | 全部使用 JSON                              |
| 错误处理   | 返回 "status": "error" 和 "message" 字段   |
| 注释规范   | 每个函数写一句用途说明                     |
| 样式规范   | 使用浅灰背景 + 卡片式任务框，hover有轻微阴影 |
| 代码测试   | 每完成一个接口后先用 Postman 测试，再接前端 |
| 时间处理   | 统一使用 ISO 格式（如 "2023-12-31T23:59:59"） |


---
## 四、交互细节（前端说明）

| 功能         | 用户操作                                   | 系统响应                                     |
|--------------|--------------------------------------------|----------------------------------------------|
| 添加任务     | 输入内容 + 选择分类/优先级/截止时间 + 点击添加 | 调用 POST /tasks，刷新任务列表               |
| 标记完成     | 点击“完成”按钮                             | 任务变灰并加删除线，调用 PUT 接口             |
| 删除任务     | 点击“删除”按钮                             | 调用 DELETE 接口，刷新列表                   |
| 搜索任务     | 输入关键词 + 点击搜索（或回车）             | 调用带 search 参数的 GET，展示匹配结果       |
| 筛选任务     | 选择分类/优先级/完成情况                   | 调用带对应参数的 GET，展示筛选结果           |
| 排序任务     | 选择时间排序方式                           | 调用带 sort 参数的 GET，按时间重新排序       |
| 显示全部     | 点击“显示全部”按钮                         | 调用不带筛选参数的 GET，展示所有任务         |
| 已截止提示   | 任务截止时间早于当前时间且未完成           | 自动标记为“已截止”并高亮显示                 |
